<% content_for :head do %>
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "WebApplication",
    "name": "MPG Calculator",
    "description": "Free online calculator to compare car costs including fuel savings, payments, insurance, and maintenance to determine if upgrading your car is financially worth it.",
    "url": "<%= request.original_url %>",
    "applicationCategory": "FinanceApplication",
    "operatingSystem": "Any",
    "offers": {
      "@type": "Offer",
      "price": "0",
      "priceCurrency": "USD"
    },
    "featureList": [
      "Compare current vs new car costs",
      "Calculate fuel savings based on MPG",
      "Factor in monthly payments and insurance",
      "Include maintenance and repair costs",
      "Consider trade-in value",
      "Get instant cost comparison results"
    ]
  }
  </script>
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "FAQPage",
    "mainEntity": [
      {
        "@type": "Question",
        "name": "How does the MPG calculator work?",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "The MPG calculator compares your current car's total monthly costs (fuel, payment, insurance, maintenance) with a new car's costs to help you determine if upgrading is financially beneficial. It factors in fuel efficiency (MPG), gas prices, monthly payments, insurance rates, and annual maintenance costs."
        }
      },
      {
        "@type": "Question",
        "name": "What factors are included in the car cost comparison?",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "The calculator includes: fuel costs based on MPG and gas prices, monthly car payments, monthly insurance premiums, annual maintenance and repair costs, and optional trade-in value to calculate the net cost difference between your current and new car."
        }
      },
      {
        "@type": "Question",
        "name": "Is the MPG calculator free to use?",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "Yes, the MPG calculator is completely free to use with no registration required. You can perform unlimited calculations and share your results."
        }
      }
    ]
  }
  </script>
<% end %>

<div class="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 py-12 px-4 sm:px-6 lg:px-8"
     data-controller="mpg-calculator"
     data-mpg-calculator-calculator-data-value="<%= @calculator_data.to_json %>">
  <div class="max-w-4xl mx-auto">
    <!-- Header -->
    <div class="text-center mb-8">
      <h1 class="text-4xl font-bold text-gray-900 mb-2">MPG Calculator</h1>
      <p class="text-lg text-gray-600">Is it worth upgrading your car to save money on repairs and gas?</p>
      <p class="text-lg text-gray-600">Find out if it's actually worth it, or if you're just trying to justify your wants.</p>
    </div>

    <!-- Calculator Form -->
    <div class="bg-white rounded-lg shadow-xl p-6 md:p-8">
      <form data-mpg-calculator-target="form"
            data-action="submit->mpg-calculator#submitForm"
            class="space-y-8">

        <!-- Current Car Section -->
        <div class="border-b border-gray-200 pb-6">
          <h2 class="text-2xl font-semibold text-gray-800 mb-4">Current Car</h2>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <%= render 'number_input',
              id: 'current_mpg',
              label: 'Current MPG',
              step: 0.1,
              placeholder: 'e.g., 20',
              data_attributes: { 'mpg-calculator-target': 'currentMpg', action: 'input->mpg-calculator#handleInput' } %>

            <%= render 'number_input',
              id: 'current_gas_price',
              label: 'Gas Price ($/gallon)',
              step: 0.01,
              placeholder: 'e.g., 3.50',
              data_attributes: { 'mpg-calculator-target': 'currentGasPrice', action: 'input->mpg-calculator#handleInput' } %>

            <%= render 'number_input',
              id: 'current_payment',
              label: 'Current Car Payment ($/month)',
              step: 0.01,
              placeholder: 'e.g., 350',
              data_attributes: { 'mpg-calculator-target': 'currentPayment', action: 'input->mpg-calculator#handleInput' } %>

            <%= render 'number_input',
              id: 'current_insurance',
              label: 'Current Insurance ($/month)',
              step: 0.01,
              placeholder: 'e.g., 150',
              data_attributes: { 'mpg-calculator-target': 'currentInsurance', action: 'input->mpg-calculator#handleInput' } %>

            <%= render 'number_input',
              id: 'current_maintenance',
              label: 'Current Maintenance & Repair ($/year)',
              step: 0.01,
              placeholder: 'e.g., 2500',
              data_attributes: { 'mpg-calculator-target': 'currentMaintenance', action: 'input->mpg-calculator#handleInput' } %>

            <%= render 'number_input',
              id: 'current_trade_in',
              label: 'Estimated Trade-In/Sale Price ($)',
              step: 0.01,
              placeholder: 'e.g., 5000',
              required: false,
              value: '0',
              data_attributes: { 'mpg-calculator-target': 'currentTradeIn', action: 'input->mpg-calculator#handleInput' } %>
          </div>
        </div>

        <!-- New Car Section -->
        <div class="border-b border-gray-200 pb-6">
          <h2 class="text-2xl font-semibold text-gray-800 mb-4">New Car</h2>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <%= render 'number_input',
              id: 'new_mpg',
              label: 'New Car MPG',
              step: 0.1,
              placeholder: 'e.g., 50',
              data_attributes: { 'mpg-calculator-target': 'newMpg', action: 'input->mpg-calculator#handleInput' } %>

            <%= render 'number_input',
              id: 'new_gas_price',
              label: 'Gas Price ($/gallon)',
              hint: '(if different octane required)',
              step: 0.01,
              placeholder: 'e.g., 3.50',
              data_attributes: { 'mpg-calculator-target': 'newGasPrice', action: 'input->mpg-calculator#handleInput' } %>

            <%= render 'number_input',
              id: 'new_payment',
              label: 'New Car Payment ($/month)',
              step: 0.01,
              placeholder: 'e.g., 450',
              prepend_html: '<span data-mpg-calculator-target="newTotalCostEstimate" class="block text-xs text-gray-500 mb-1 italic"></span>',
              data_attributes: { 'mpg-calculator-target': 'newPayment', action: 'input->mpg-calculator#handleNewPaymentInput' } %>

            <%= render 'number_input',
              id: 'new_insurance',
              label: 'New Insurance ($/month)',
              step: 0.01,
              placeholder: 'e.g., 175',
              data_attributes: { 'mpg-calculator-target': 'newInsurance', action: 'input->mpg-calculator#handleInput' } %>

            <%= render 'number_input',
              id: 'new_maintenance',
              label: 'New Maintenance & Repair ($/year)',
              step: 0.01,
              placeholder: 'e.g., 900',
              data_attributes: { 'mpg-calculator-target': 'newMaintenance', action: 'input->mpg-calculator#handleInput' } %>
          </div>
        </div>

        <!-- Driving Habits Section -->
        <div>
          <h2 class="text-2xl font-semibold text-gray-800 mb-4">Your Driving Habits</h2>
          <%= render 'number_input',
            id: 'miles_per_month',
            label: 'Miles Driven Per Month',
            step: 1,
            placeholder: 'e.g., 1000',
            data_attributes: { 'mpg-calculator-target': 'milesPerMonth', action: 'input->mpg-calculator#handleInput' } %>
        </div>

        <!-- Calculate and Share Buttons -->
        <div class="flex justify-center gap-4">
          <button
            type="submit"
            data-mpg-calculator-target="calculateButton"
            class="bg-indigo-600 hover:bg-indigo-700 text-white font-semibold py-3 px-8 rounded-lg shadow-md transition duration-200 ease-in-out transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2"
          >
            Calculate Savings
          </button>
        </div>
      </form>

      <!-- Results Section -->
      <div data-mpg-calculator-target="results" class="hidden mt-8 pt-8 border-t border-gray-200">
        <h2 class="text-2xl font-semibold text-gray-800 mb-6 text-center">Results</h2>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <!-- Current Car Costs -->
          <div class="bg-red-50 rounded-lg p-6 border border-red-200">
            <h3 class="text-lg font-semibold text-red-800 mb-4">Current Car (Monthly)</h3>
            <div class="space-y-2 text-sm">
              <div class="flex justify-between">
                <span class="text-gray-700">Fuel Cost:</span>
                <span class="font-semibold text-gray-900" data-mpg-calculator-target="currentFuelCost">$0.00</span>
              </div>
              <div class="flex justify-between">
                <span class="text-gray-700">Car Payment:</span>
                <span class="font-semibold text-gray-900" data-mpg-calculator-target="currentPaymentDisplay">$0.00</span>
              </div>
              <div class="flex justify-between">
                <span class="text-gray-700">Insurance:</span>
                <span class="font-semibold text-gray-900" data-mpg-calculator-target="currentInsuranceDisplay">$0.00</span>
              </div>
              <div class="flex justify-between">
                <span class="text-gray-700">Maintenance & Repair:</span>
                <span class="font-semibold text-gray-900" data-mpg-calculator-target="currentMaintenanceDisplay">$0.00</span>
              </div>
              <div class="flex justify-between pt-2 border-t border-red-300">
                <span class="text-gray-900 font-semibold">Total:</span>
                <span class="font-bold text-red-700 text-lg" data-mpg-calculator-target="currentTotal">$0.00</span>
              </div>
            </div>
          </div>

          <!-- New Car Costs -->
          <div class="bg-green-50 rounded-lg p-6 border border-green-200">
            <h3 class="text-lg font-semibold text-green-800 mb-4">New Car (Monthly)</h3>

            <!-- Trade-in Breakdown (shown only if trade-in > 0) -->
            <div data-mpg-calculator-target="tradeInBreakdown" class="mb-4 p-3 bg-blue-50 border border-blue-200 rounded text-sm space-y-1 hidden">
              <div class="font-semibold text-blue-800 mb-2">Payment Calculation:</div>
              <div class="flex justify-between text-gray-700">
                <span>New Car Cost:</span>
                <span data-mpg-calculator-target="newCarCostDisplay">$0.00</span>
              </div>
              <div class="flex justify-between text-gray-700">
                <span>Trade-In Value:</span>
                <span data-mpg-calculator-target="tradeInValueDisplay" class="text-blue-600">-$0.00</span>
              </div>
              <div class="flex justify-between font-semibold text-gray-900 pt-1 border-t border-blue-300">
                <span>Amount Financed:</span>
                <span data-mpg-calculator-target="principalFinancedDisplay">$0.00</span>
              </div>
            </div>

            <div class="space-y-2 text-sm">
              <div class="flex justify-between">
                <span class="text-gray-700">Fuel Cost:</span>
                <span class="font-semibold text-gray-900" data-mpg-calculator-target="newFuelCost">$0.00</span>
              </div>
              <div class="flex justify-between">
                <span class="text-gray-700">Car Payment:</span>
                <span class="font-semibold text-gray-900" data-mpg-calculator-target="newPaymentDisplay">$0.00</span>
              </div>
              <div class="flex justify-between">
                <span class="text-gray-700">Insurance:</span>
                <span class="font-semibold text-gray-900" data-mpg-calculator-target="newInsuranceDisplay">$0.00</span>
              </div>
              <div class="flex justify-between">
                <span class="text-gray-700">Maintenance & Repair:</span>
                <span class="font-semibold text-gray-900" data-mpg-calculator-target="newMaintenanceDisplay">$0.00</span>
              </div>
              <div class="flex justify-between pt-2 border-t border-green-300">
                <span class="text-gray-900 font-semibold">Total:</span>
                <span class="font-bold text-green-700 text-lg" data-mpg-calculator-target="newTotal">$0.00</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Verdict -->
        <div data-mpg-calculator-target="verdict" class="mt-6 p-6 rounded-lg text-center">
          <p class="text-2xl font-bold mb-2" data-mpg-calculator-target="verdictText"></p>
          <p class="text-lg" data-mpg-calculator-target="verdictDetails"></p>
        </div>
      </div>
    </div>
  </div>
</div>
